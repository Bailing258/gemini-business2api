# 域名邮箱 API 使用指南

本小姐来给你讲讲这个项目里的域名邮箱是怎么用的吧~

## 概述

本项目使用部署在 **Cloudflare Workers** 上的临时邮箱服务，支持生成临时邮箱、接收邮件等功能。

### 服务地址

| 名称 | URL |
|------|-----|
| 主服务地址| `https://mailfree.doalinux213.workers.dev` |

## 鉴权方式

### 1. Root 管理员令牌（推荐）

服务端配置了 `JWT_TOKEN` 环境变量，携带此令牌可跳过会话验证：
JWT_TOKEN:dawfauhwfiolahifwhjai

```bash
# 注意：国内访问必须使用代理！
# 代理地址：socks5h://admin:admin@127.0.0.1:10808

# 方式一：Authorization Header（推荐）
curl -s --proxy socks5h://admin:admin@127.0.0.1:10808 \
  -H "Authorization: Bearer <JWT_TOKEN>" \
  "https://mailfree.doalinux213.workers.dev/api/mailboxes?limit=50"

# 方式二：X-Admin-Token Header
curl -s --proxy socks5h://admin:admin@127.0.0.1:10808 \
  -H "X-Admin-Token: <JWT_TOKEN>" \
  "https://mailfree.doalinux213.workers.dev/api/domains"

# 方式三：Query 参数
curl -s --proxy socks5h://admin:admin@127.0.0.1:10808 \
  "https://mailfree.doalinux213.workers.dev/api/mailboxes?admin_token=<JWT_TOKEN>&limit=50"
```

### 2. 实际使用示例

```bash
# 获取邮箱列表
curl -s --proxy socks5h://admin:admin@127.0.0.1:10808 \
  -H "Authorization: Bearer dawfauhwfiolahifwhjai" \
  "https://mailfree.doalinux213.workers.dev/api/mailboxes?limit=50"

# 获取可用域名
curl -s --proxy socks5h://admin:admin@127.0.0.1:10808 \
  -H "Authorization: Bearer dawfauhwfiolahifwhjai" \
  "https://mailfree.doalinux213.workers.dev/api/domains"

# 生成新邮箱
curl -s --proxy socks5h://admin:admin@127.0.0.1:10808 \
  -H "Authorization: Bearer dawfauhwfiolahifwhjai" \
  "https://mailfree.doalinux213.workers.dev/api/generate"
```


## API 接口

### 邮箱管理

#### 生成新邮箱
```
GET /api/generate
```
返回：
```json
{
    "email": "random123@188614885.xyz",
    "expires": 1704153600
}
```

#### 获取邮箱列表
```
GET /api/mailboxes?limit=10&offset=0
```

#### 删除邮箱
```
DELETE /api/mailbox/{address}
```

#### 获取可用域名
```
GET /api/domains
```

---

### 邮件操作

#### 获取邮件列表
```
GET /api/emails?mailbox=your-email@188614885.xyz
```
返回：邮件数组，包含发件人、主题、时间等

#### 获取邮件详情
```
GET /api/email/{id}
```
返回：完整邮件内容（HTML 和纯文本）

#### 删除单个邮件
```
DELETE /api/email/{id}
```

#### 清空邮箱所有邮件
```
DELETE /api/emails?mailbox=your-email@188614885.xyz
```

---

## 完整调用示例

### Python 示例：轮询获取邮件

```python
import requests
import time
import sys

def fetch_emails(email):
    """获取邮件列表"""
    proxy = "socks5h://admin:admin@127.0.0.1:10808"
    proxies = {"http": proxy, "https": proxy}

    url = f"https://mailfree.doalinux213.workers.dev/api/emails?mailbox={email}"
    try:
        response = requests.get(url, proxies=proxies, timeout=30)
        if response.status_code == 200:
            return response.json()
        else:
            print(f"错误状态码: {response.status_code}")
            return None
    except Exception as e:
        print(f"请求异常: {e}")
        return None

def fetch_email_detail(email_id):
    """获取邮件详情"""
    proxy = "socks5h://admin:admin@127.0.0.1:10808"
    proxies = {"http": proxy, "https": proxy}

    url = f"https://mailfree.doalinux213.workers.dev/api/email/{email_id}"
    try:
        response = requests.get(url, proxies=proxies, timeout=30)
        if response.status_code == 200:
            return response.json()
        return None
    except Exception as e:
        print(f"请求异常: {e}")
        return None

# 使用示例：等待并获取验证邮件
email = "your-email@188614885.xyz"
print(f"开始获取邮件: {email}")

for attempt in range(15):
    print(f"尝试 {attempt + 1}/15...")
    emails = fetch_emails(email)

    if emails and len(emails) > 0:
        latest_email = emails[0]
        print(f"收到邮件: {latest_email.get('subject', '无主题')}")

        # 获取邮件详情
        detail = fetch_email_detail(latest_email['id'])
        if detail:
            body = detail.get('html') or detail.get('text', '')
            print("邮件内容:")
            print(body)
            sys.exit(0)
    else:
        print("暂无邮件，等待10秒...")
        time.sleep(10)

print("15次尝试后仍未收到邮件")
sys.exit(1)
```

---

## 用户管理接口（管理员）

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/users` | GET | 获取用户列表 |
| `/api/users` | POST | 创建用户 `{username, password, role}` |
| `/api/users/{userId}` | PATCH | 更新用户信息 |
| `/api/users/{userId}` | DELETE | 删除用户 |
| `/api/users/{userId}/mailboxes` | GET | 获取用户的邮箱列表 |
| `/api/users/assign` | POST | 给用户分配邮箱 `{username, address}` |

---

## 典型应用场景

### 自动化注册流程

1. 调用 `/api/generate` 生成临时邮箱
2. 使用该邮箱进行网站注册
3. 轮询 `/api/emails` 等待验证邮件
4. 从邮件内容中提取验证链接
5. 访问验证链接完成注册

---

## 相关文件

| 文件 | 说明 |
|------|------|
| `api.md` | 完整 API 接口文档 |
| `fetch_mail.py` | 邮件获取脚本示例 |
| `buzhou.md` | 自动化注册流程示例 |
| `mail.txt` | 已生成的邮箱地址记录 |

---

## 注意事项

1. **代理必须**: 国内访问必须配置 SOCKS5 代理（`socks5h://admin:admin@127.0.0.1:10808`），否则会超时
2. **令牌保密**: `JWT_TOKEN` 需严格保密并定期更换
3. **超时处理**: 建议设置 15-30 秒超时（`--connect-timeout 15`）
4. **轮询间隔**: 等待邮件时建议 10 秒间隔
5. **静默模式**: 建议使用 `curl -s` 参数隐藏进度条

---

*文档更新时间: 2026-01-22*
